一套SaaS ERP/零售混合系统源码, 采用SpringBoot+Vue+ElementUI+UniAPP开发，功能包括：商品、订单、采购、生产、库存、报工、成本、用户、门店、顾客和会员、促销、POS，CRM等  
目标：让开发一眼知道“表放哪、服务怎么拆、谁调谁”，业务一眼看懂“单据在哪录、账在哪算”。  

------------------------------------------------  
分层总览  
UI 层（前端/小程序/POS）  
→ 网关层（统一鉴权、限流、POS 离线同步）  
→ 服务层（10 个微服务，见下）  
→ 事件总线（RabbitMQ/Kafka，仅发“业务事件”）  
→ 数据层（MySQL 主库 + 库存独享分库 + BI 读库）  

------------------------------------------------  
服务-数据-事件对照表（=架构蓝图）  

| 服务 | 核心表（仅列主表） | 向外发事件（Kafka Topic） | 向外暴露 API（REST） | 备注 |
|---|---|---|---|---|
| ① 商品中心 | item / item_sku / item_barcode / item_category | ItemCreated / ItemUpdated | /item/* | 全局唯一 SKU_ID，禁止其他服务私建商品表 |
| ② 用户中心 | user / user_role / org | UserCreated / UserUpdated | /user/* | 统一登录，门店、供应商、员工都是 user 挂不同 role |
| ③ 采购中心 | po_order / po_detail / supplier | PoApproved / PoInStock | /po/* | 到货后写库存中心，发 PoInStock 事件 |
| ④ 生产中心 | mo_order / mo_bom / mo_routing | MoStarted / MoCompleted | /mo/* | 仅管“生产订单+工艺”，实际用料由库存中心扣 |
| ⑤ 报工中心 | report_job / report_loss | JobReported | /job/* | 接收 POS/APP 报工，完工后发 MoCompleted |
| ⑥ 库存中心 | stock / stock_detail / stock_move | StockIn / StockOut / StockChanged | /stock/* | 唯一实物账，任何入库、出库必须调库存 API |
| ⑦ 成本中心 | cost_sheet / cost_item | CostCalculated | /cost/* | 监听 StockChanged 与 MoCompleted，月加权或移动平均算成本 |
| ⑧ 订单中心 | so_order / so_detail / payment | OrderPaid / OrderShipped | /order/* | 销售订单，来自电商小程序或 POS 离线单 |
| ⑨ 会员中心 | member / member_point / member_coupon | MemberPointChanged | /member/* | 积分、等级、储值 |
| ⑩ 促销中心 | promo / promo_rule / promo_record | PromoApplied | /promo/* | 提供“算价”接口，被 POS/小程序在下单时调用 |

------------------------------------------------  
关键调用链（只画 3 条最核心）  

1. POS 开单链路  
POS 离线→本机 SQLite 暂存→联网后先调 ⑩ 促销中心 /promo/calc 算价→再调 ⑧ 订单中心 /order/create→订单中心调 ⑥ 库存中心 /stock/lock 锁库存→支付成功后发 OrderPaid 事件→⑥ 库存中心监听真正 /stock/out 出库。

2. 生产领料链路  
④ 生产中心创建 MO→发 MoStarted 事件→⑥ 库存中心监听自动 /stock/out 扣料→⑤ 报工中心收到工人扫码报工→完工后发 MoCompleted→⑦ 成本中心监听算成本并发 CostCalculated。

3. 采购入库链路  
③ 采购中心发 PoApproved→仓库收货后调 ⑥ 库存中心 /stock/in→⑥ 发 StockIn 事件→⑦ 成本中心重算最新成本→财务监听生成暂估凭证。

------------------------------------------------  
数据归属原则（防止“各写各的账”）  

- 实物数量：只能 ⑥ 库存中心写 stock 表，其他服务只调 API。  
- 成本金额：只能 ⑦ 成本中心写 cost_sheet，其他服务只读视图。  
- 商品主档：只能 ① 商品中心写 item，其他服务只存 SKU_ID 外键。  
- 会员积分：只能 ⑨ 会员中心写 member_point，促销或订单只调 /point/change 接口。  

------------------------------------------------  
部署与扩展提示  

- ⑥ 库存中心访问量最大，单独分库（按仓库 ID 分片），其他服务共用主库。  
- POS 端内置 SQLite 离线库，表结构跟 ⑧ 订单中心、⑥ 库存中心完全一致，联网后差异同步。  
- 事件总线只发“业务已发生”的事实，不发指令；指令用同步 API，避免分布式事务。  

------------------------------------------------  
一张蓝图（文字版）  

```
┌---------┐     ┌---------┐     ┌---------┐
│ 小程序   │     │ 门店POS  │     │ 管理后台 │
└----┬----┘     └----┬----┘     └----┬----┘
     │              │               │
     └--------------┴---------------┘
            │ 统一网关 /oauth
┌---------┴---------┴---------┴---------┐
│  服务层（10 个微服务，见上表）          │
│  ①商品 ②用户 ③采购 ④生产 ⑤报工        │
│  ⑥库存 ⑦成本 ⑧订单 ⑨会员 ⑩促销        │
└----------------┬----------------------┘
        │ Kafka 事件总线
┌---------┴---------------------------┐
│ 数据层                              │
│ MySQL 主库 + 库存分库 + BI 读库      │
└-------------------------------------┘
```

------------------------------------------------  
照着这张蓝图建仓库、定表结构、写 API 文档，2 周内就能把骨架跑通；后续业务再怎么迭代，只要守住“谁的数据谁写、事件只发事实”两条底线，就不会出现库存与实物、成本与财务对不上账的大坑。